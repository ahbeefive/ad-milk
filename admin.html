<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Content Management</title>
    <link rel="stylesheet" href="admin-styles.css?v=2">
</head>
<body>
    <!-- Auth Check Script -->
    <script>
        // Check authentication before loading page
        if (sessionStorage.getItem('adminLoggedIn') !== 'true') {
            window.location.href = 'login.html';
        }
        
        // Check session expiry
        const loginTime = sessionStorage.getItem('adminLoginTime');
        if (loginTime) {
            const hoursPassed = (Date.now() - loginTime) / (1000 * 60 * 60);
            if (hoursPassed >= 8) {
                sessionStorage.removeItem('adminLoggedIn');
                sessionStorage.removeItem('adminLoginTime');
                window.location.href = 'login.html';
            }
        }
    </script>
    
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h2>‚öôÔ∏è Admin Panel</h2>
            </div>
            <nav class="admin-nav">
                <button class="nav-item active" data-tab="products">
                    üì¶ All Products
                </button>
                <button class="nav-item" data-tab="posts">
                    üìù Posts
                </button>
                <button class="nav-item" data-tab="promotions">
                    üéÅ Promotions
                </button>
                <button class="nav-item" data-tab="banners">
                    üì∏ Banners
                </button>
                <button class="nav-item" data-tab="events">
                    üìÖ Events
                </button>
                <button class="nav-item" data-tab="categories">
                    üè∑Ô∏è Categories
                </button>
                <button class="nav-item" data-tab="sections">
                    üìã Section Management
                </button>
                <button class="nav-item" data-tab="themes">
                    üé® Themes
                </button>
                <button class="nav-item" data-tab="settings">
                    ‚öôÔ∏è Settings
                </button>
                <button class="nav-item" data-tab="view">
                    üåê View Website
                </button>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="admin-header">
                <h1 id="pageTitle">Product Management</h1>
                <div class="header-actions">
                    <button class="btn-debug" onclick="debugRefresh()" style="background:#28a745;color:white;padding:8px 15px;border:none;border-radius:5px;margin-right:10px;">üîÑ Refresh Tables</button>
                    <button class="btn-logout">Logout</button>
                </div>
            </header>

            <!-- Products Tab -->
            <div id="products" class="tab-content active">
                <div class="content-header">
                    <button class="btn-primary" onclick="addProduct()">+ Add Product</button>
                    <div class="help-tip" style="margin-top: 15px;">
                        <strong>üí° Tip:</strong> Upload images from PC or use URLs. You can also add product videos from YouTube, Facebook, TikTok, or Instagram!
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Image</th>
                                <th>Name (EN)</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Posts Tab -->
            <div id="posts" class="tab-content">
                <div class="content-header">
                    <button class="btn-primary" onclick="addPost()">+ Add Post</button>
                    <div class="help-tip" style="margin-top: 15px;">
                        <strong>üí° Tip:</strong> Create engaging posts with images and content. Posts will appear in the Post section of your website.
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Image</th>
                                <th>Title (EN)</th>
                                <th>Title (KM)</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="postsTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Promotions Tab -->
            <div id="promotions" class="tab-content">
                <div class="content-header">
                    <button class="btn-primary" onclick="addPromotion()">+ Add Promotion</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Image</th>
                                <th>Title (EN)</th>
                                <th>Title (KM)</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="promotionsTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Banners Tab -->
            <div id="banners" class="tab-content">
                <div class="content-header">
                    <button class="btn-primary" onclick="addBanner()">+ Add Banner</button>
                    <div class="help-tip" style="margin-top: 15px;">
                        <strong>üí° Tip:</strong> You can upload images from your PC or use an image URL. Supported formats: JPG, PNG, GIF, WebP.
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Preview</th>
                                <th>Link</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="bannersTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Events Tab -->
            <div id="events" class="tab-content">
                <div class="content-header">
                    <button class="btn-primary" onclick="addEvent()">+ Add Event</button>
                    <div class="help-tip" style="margin-top: 15px;">
                        <strong>üí° Tip:</strong> For video events, just paste the regular video URL from YouTube, Facebook, TikTok, or Instagram. The system will automatically convert it to the correct embed format!
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title (EN)</th>
                                <th>Type</th>
                                <th>Media</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="eventsTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Categories Tab -->
            <div id="categories" class="tab-content">
                <div class="content-header">
                    <button class="btn-primary" onclick="addCategory()">+ Add Category</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name (EN)</th>
                                <th>Name (KM)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="categoriesTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Section Management Tab -->
            <div id="sections" class="tab-content">
                <div class="content-header">
                    <button class="btn-primary" onclick="addCustomSection()">+ Add Custom Section</button>
                    <div class="help-tip" style="margin-top: 15px;">
                        <strong>üí° Tip:</strong> Enable/disable sections or create custom sections with their own card templates. Custom sections can display any type of content you want!<br>
                        <strong>üîÑ Drag & Drop:</strong> Use the ‚ãÆ‚ãÆ handle to drag and reorder sections. Changes apply immediately to your website navigation.
                    </div>
                </div>
                <div class="table-container">
                    <h3>Default Sections</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Section</th>
                                <th>Name (EN)</th>
                                <th>Name (KM)</th>
                                <th>Status</th>
                                <th>Order</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="defaultSectionsTable"></tbody>
                    </table>
                    
                    <h3 style="margin-top: 30px;">Custom Sections</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name (EN)</th>
                                <th>Name (KM)</th>
                                <th>Template</th>
                                <th>Status</th>
                                <th>Order</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customSectionsTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Themes Tab -->
            <div id="themes" class="tab-content">
                <div class="content-header">
                    <p>Select the active theme for your website</p>
                </div>
                <div class="themes-grid" id="themesGrid"></div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <div class="settings-form">
                    <!-- GitHub Auto-Deploy Section -->
                    <div style="background: linear-gradient(135deg, #24292e 0%, #0366d6 100%); padding: 25px; border-radius: 10px; margin-bottom: 30px; color: white;">
                        <h3 style="color: white; margin-top: 0;">üöÄ GitHub Auto-Deploy (Recommended)</h3>
                        <p style="margin: 10px 0; opacity: 0.9;">One-click publish to GitHub! No manual work needed.</p>
                        
                        <div id="githubNotConfigured" style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 5px; margin: 15px 0;">
                            <strong>‚öôÔ∏è Setup Required (One-Time Only):</strong>
                            <div style="margin-top: 10px;">
                                <div style="margin: 10px 0;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 14px;">GitHub Username:</label>
                                    <input type="text" id="githubUsername" placeholder="your-username" style="width: 100%; padding: 8px; border-radius: 5px; border: none; color: #333;">
                                </div>
                                <div style="margin: 10px 0;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 14px;">Repository Name:</label>
                                    <input type="text" id="githubRepo" placeholder="my-website" style="width: 100%; padding: 8px; border-radius: 5px; border: none; color: #333;">
                                </div>
                                <div style="margin: 10px 0;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 14px;">Personal Access Token:</label>
                                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx" style="width: 100%; padding: 8px; border-radius: 5px; border: none; color: #333;">
                                    <small style="display: block; margin-top: 5px; opacity: 0.8;">
                                        <a href="https://github.com/settings/tokens/new?scopes=repo&description=Cloudflare%20Deploy" target="_blank" style="color: #ffc107;">
                                            ‚Üí Get Token Here (Click to create)
                                        </a>
                                    </small>
                                </div>
                                <div style="margin: 10px 0;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 14px;">Branch (default: main):</label>
                                    <input type="text" id="githubBranch" placeholder="main" value="main" style="width: 100%; padding: 8px; border-radius: 5px; border: none; color: #333;">
                                </div>
                                <button onclick="saveGitHubConfig()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px;">
                                    üíæ Save GitHub Settings
                                </button>
                            </div>
                        </div>
                        
                        <div id="githubConfigured" style="display: none;">
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                                <strong>‚úÖ GitHub Connected:</strong>
                                <div style="margin-top: 8px; font-size: 14px;">
                                    <div>üì¶ Repo: <span id="displayRepo"></span></div>
                                    <div>üåø Branch: <span id="displayBranch"></span></div>
                                </div>
                                <button onclick="editGitHubConfig()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 12px; margin-top: 8px;">
                                    ‚öôÔ∏è Edit Settings
                                </button>
                            </div>
                            
                            <button onclick="publishToGitHub()" id="publishBtn" style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 16px; width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px;">
                                <span>üöÄ Publish to GitHub Now</span>
                            </button>
                            
                            <div id="publishStatus" style="margin-top: 15px; padding: 12px; border-radius: 5px; display: none;"></div>
                        </div>
                    </div>
                    
                    <!-- Manual Export Section (Backup Method) -->
                    <details style="margin-bottom: 30px;">
                        <summary style="cursor: pointer; padding: 15px; background: #f8f9fa; border-radius: 5px; font-weight: bold; color: #333;">
                            üì¶ Manual Export (Backup Method)
                        </summary>
                        <div style="padding: 20px; background: #f8f9fa; border-radius: 0 0 5px 5px; margin-top: -5px;">
                            <p style="color: #666; margin-bottom: 15px;">Use this if GitHub auto-deploy is not working.</p>
                            
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button onclick="exportConfigData()" style="background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-weight: bold; flex: 1; min-width: 150px;">
                                    üì§ Export Data
                                </button>
                                <button onclick="downloadConfigFile()" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-weight: bold; flex: 1; min-width: 150px;">
                                    üíæ Download config.js
                                </button>
                                <button onclick="downloadConfigJSON()" style="background: #17a2b8; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-weight: bold; flex: 1; min-width: 150px;">
                                    üì• Download JSON
                                </button>
                                <button onclick="document.getElementById('importFileInput').click()" style="background: #ffc107; color: #333; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-weight: bold; flex: 1; min-width: 150px;">
                                    üì• Import Data
                                </button>
                            </div>
                            
                            <input type="file" id="importFileInput" accept=".js,.json,.txt" style="display: none;" onchange="importConfigData(this)">
                            
                            <div id="exportResult" style="margin-top: 15px; display: none;">
                                <textarea id="exportedConfigCode" readonly style="width: 100%; height: 200px; padding: 10px; border-radius: 5px; border: 1px solid #ddd; font-family: monospace; font-size: 12px; background: white; color: #333;"></textarea>
                                <button onclick="copyExportedCode()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px; font-weight: bold;">
                                    üìã Copy to Clipboard
                                </button>
                            </div>
                        </div>
                    </details>
                    
                    <!-- Clear All Data Section -->
                    <details style="margin-bottom: 30px;">
                        <summary style="cursor: pointer; padding: 15px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 5px; font-weight: bold; color: #856404;">
                            ‚ö†Ô∏è Danger Zone - Clear All Data
                        </summary>
                        <div style="padding: 20px; background: #fff3cd; border: 2px solid #ffc107; border-top: none; border-radius: 0 0 5px 5px; margin-top: -5px;">
                            <div style="background: white; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                                <strong style="color: #856404;">‚ö†Ô∏è Warning:</strong>
                                <p style="color: #666; margin: 10px 0;">These actions will delete data from your browser. Make sure to export/backup first!</p>
                            </div>
                            
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button onclick="clearAllContent()" style="background: #dc3545; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-weight: bold; flex: 1; min-width: 200px;">
                                    üóëÔ∏è Clear All Content
                                </button>
                                <button onclick="resetToDefault()" style="background: #fd7e14; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-weight: bold; flex: 1; min-width: 200px;">
                                    üîÑ Reset to Default
                                </button>
                            </div>
                            
                            <div style="background: white; padding: 15px; border-radius: 5px; margin-top: 15px; font-size: 14px;">
                                <strong>What each button does:</strong>
                                <ul style="margin: 10px 0; padding-left: 20px; color: #666;">
                                    <li><strong>Clear All Content:</strong> Removes all products, posts, banners, promotions, events. Keeps settings and theme.</li>
                                    <li><strong>Reset to Default:</strong> Removes EVERYTHING including settings. Fresh start like new installation.</li>
                                </ul>
                                <p style="color: #dc3545; margin: 10px 0; font-weight: bold;">‚ö†Ô∏è These actions cannot be undone! Export your data first!</p>
                            </div>
                        </div>
                    </details>
                    
                    <h3>Logo Settings</h3>
                    <div class="form-group">
                        <label>Upload Logo (PNG or JPG)</label>
                        <input type="file" id="logoFile" class="form-control" accept="image/*" onchange="previewLogo(this)">
                        <small class="help-text">Recommended size: 200x50px or similar ratio</small>
                    </div>
                    <div class="form-group">
                        <label>Or Logo URL</label>
                        <input type="text" id="logoUrl" class="form-control" placeholder="https://example.com/logo.png">
                    </div>
                    <div id="logoPreview" class="image-preview"></div>
                    <input type="hidden" id="logoImage" value="">
                    
                    <h3 style="margin-top: 30px;">Navigation Style</h3>
                    <div class="form-group">
                        <label>Select Navigation Style</label>
                        <select id="navStyle" class="form-control" onchange="toggleCustomNavColors()">
                            <option value="solid">Solid (Default Black)</option>
                            <option value="glass">Glass (Modern Transparent)</option>
                            <option value="gradient">Gradient (Colorful)</option>
                            <option value="custom">Custom Colors</option>
                        </select>
                    </div>
                    
                    <div id="customNavColors" style="display:none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <h4>Custom Navigation Colors</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Background Color</label>
                                <input type="color" id="navBgColor" class="form-control" value="#2c3e50">
                            </div>
                            <div class="form-group">
                                <label>Text Color</label>
                                <input type="color" id="navTextColor" class="form-control" value="#ffffff">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Active Button Color</label>
                            <input type="color" id="navActiveColor" class="form-control" value="#e74c3c">
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px;">Post Banner</h3>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="problemBannerEnabled"> Enable Banner
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Banner Image URL</label>
                        <input type="text" id="problemBannerImage" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Banner Link URL</label>
                        <input type="text" id="problemBannerLink" class="form-control">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Title (English)</label>
                            <input type="text" id="problemBannerTitleEn" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Title (Khmer)</label>
                            <input type="text" id="problemBannerTitleKm" class="form-control">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Description (English)</label>
                            <input type="text" id="problemBannerDescEn" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Description (Khmer)</label>
                            <input type="text" id="problemBannerDescKm" class="form-control">
                        </div>
                    </div>
                    
                    <hr style="margin: 30px 0;">
                    
                    <h3>Contact Information</h3>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="text" id="settingPhone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="settingEmail" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Address</label>
                        <input type="text" id="settingAddress" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="text" id="settingPhone" class="form-control" placeholder="+1234567890">
                    </div>
                    <div class="form-group">
                        <label>WhatsApp</label>
                        <input type="text" id="settingWhatsapp" class="form-control" placeholder="+1234567890">
                    </div>
                    <div class="form-group">
                        <label>Telegram</label>
                        <input type="text" id="settingTelegram" class="form-control" placeholder="https://t.me/username">
                    </div>
                    <div class="form-group">
                        <label>Facebook</label>
                        <input type="text" id="settingFacebook" class="form-control" placeholder="https://facebook.com/username">
                    </div>
                    <div class="form-group">
                        <label>Messenger</label>
                        <input type="text" id="settingMessenger" class="form-control" placeholder="https://m.me/username">
                    </div>
                    <div class="form-group">
                        <label>Post Section Link</label>
                        <input type="text" id="settingProblemLink" class="form-control">
                    </div>
                    <button class="btn-primary" onclick="saveSettings()">Save Settings</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal for Add/Edit -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Add Item</h2>
            <div id="modalForm"></div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="admin-script.js"></script>
</body>
</html>
